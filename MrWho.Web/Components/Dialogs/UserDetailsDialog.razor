@inject DialogService DialogService

<div class="user-details">
    <div class="row">
        <div class="col-12">
            <RadzenFieldset Text="Personal Information">
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <RadzenText TextStyle="TextStyle.Subtitle2" Class="mb-1">First Name</RadzenText>
                        <RadzenText TextStyle="TextStyle.Body1">@(User?.FirstName ?? "Not specified")</RadzenText>
                    </div>
                    <div class="col-md-6 mb-3">
                        <RadzenText TextStyle="TextStyle.Subtitle2" Class="mb-1">Last Name</RadzenText>
                        <RadzenText TextStyle="TextStyle.Body1">@(User?.LastName ?? "Not specified")</RadzenText>
                    </div>
                </div>
            </RadzenFieldset>
        </div>
    </div>

    <div class="row mt-3">
        <div class="col-12">
            <RadzenFieldset Text="Account Information">
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <RadzenText TextStyle="TextStyle.Subtitle2" Class="mb-1">Email Address</RadzenText>
                        <RadzenText TextStyle="TextStyle.Body1">@User?.Email</RadzenText>
                    </div>
                    <div class="col-md-6 mb-3">
                        <RadzenText TextStyle="TextStyle.Subtitle2" Class="mb-1">Username</RadzenText>
                        <RadzenText TextStyle="TextStyle.Body1">@User?.UserName</RadzenText>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <RadzenText TextStyle="TextStyle.Subtitle2" Class="mb-1">User ID</RadzenText>
                        <RadzenText TextStyle="TextStyle.Body2" Class="text-muted font-monospace">@User?.Id</RadzenText>
                    </div>
                    <div class="col-md-6 mb-3">
                        <RadzenText TextStyle="TextStyle.Subtitle2" Class="mb-1">Account Status</RadzenText>
                        <RadzenBadge Variant="Variant.Filled" 
                                   BadgeStyle="@(User?.IsActive == true ? BadgeStyle.Success : BadgeStyle.Danger)"
                                   Text="@(User?.IsActive == true ? "Active" : "Inactive")" />
                    </div>
                </div>
            </RadzenFieldset>
        </div>
    </div>

    <div class="row mt-3">
        <div class="col-12">
            <RadzenFieldset Text="Account Activity">
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <RadzenText TextStyle="TextStyle.Subtitle2" Class="mb-1">Account Created</RadzenText>
                        <RadzenText TextStyle="TextStyle.Body1">
                            @User?.CreatedAt.ToString("MMMM dd, yyyy 'at' HH:mm")
                        </RadzenText>
                        <RadzenText TextStyle="TextStyle.Caption" Class="text-muted">
                            @GetRelativeTime(User?.CreatedAt)
                        </RadzenText>
                    </div>
                    <div class="col-md-6 mb-3">
                        <RadzenText TextStyle="TextStyle.Subtitle2" Class="mb-1">Account Age</RadzenText>
                        <RadzenText TextStyle="TextStyle.Body1">
                            @GetAccountAge(User?.CreatedAt)
                        </RadzenText>
                    </div>
                </div>
            </RadzenFieldset>
        </div>
    </div>

    <div class="text-end mt-4">
        <RadzenButton Text="Close" 
                    ButtonStyle="ButtonStyle.Light" 
                    Click="@(() => DialogService.Close())" />
    </div>
</div>

<style>
    .user-details .font-monospace {
        font-family: 'Courier New', Courier, monospace;
        font-size: 0.9em;
    }
</style>

@code {
    [Parameter] public UserRegistrationResponse? User { get; set; }

    private string GetRelativeTime(DateTime? dateTime)
    {
        if (dateTime == null) return "";
        
        var timeSpan = DateTime.UtcNow - dateTime.Value;
        
        if (timeSpan.TotalDays >= 365)
        {
            var years = (int)(timeSpan.TotalDays / 365);
            return $"{years} year{(years > 1 ? "s" : "")} ago";
        }
        else if (timeSpan.TotalDays >= 30)
        {
            var months = (int)(timeSpan.TotalDays / 30);
            return $"{months} month{(months > 1 ? "s" : "")} ago";
        }
        else if (timeSpan.TotalDays >= 1)
        {
            var days = (int)timeSpan.TotalDays;
            return $"{days} day{(days > 1 ? "s" : "")} ago";
        }
        else if (timeSpan.TotalHours >= 1)
        {
            var hours = (int)timeSpan.TotalHours;
            return $"{hours} hour{(hours > 1 ? "s" : "")} ago";
        }
        else if (timeSpan.TotalMinutes >= 1)
        {
            var minutes = (int)timeSpan.TotalMinutes;
            return $"{minutes} minute{(minutes > 1 ? "s" : "")} ago";
        }
        else
        {
            return "Just now";
        }
    }

    private string GetAccountAge(DateTime? dateTime)
    {
        if (dateTime == null) return "Unknown";
        
        var timeSpan = DateTime.UtcNow - dateTime.Value;
        
        if (timeSpan.TotalDays >= 365)
        {
            var years = (int)(timeSpan.TotalDays / 365);
            var remainingDays = (int)(timeSpan.TotalDays % 365);
            var months = remainingDays / 30;
            
            if (months > 0)
                return $"{years} year{(years > 1 ? "s" : "")} and {months} month{(months > 1 ? "s" : "")}";
            else
                return $"{years} year{(years > 1 ? "s" : "")}";
        }
        else if (timeSpan.TotalDays >= 30)
        {
            var months = (int)(timeSpan.TotalDays / 30);
            var remainingDays = (int)(timeSpan.TotalDays % 30);
            
            if (remainingDays > 0)
                return $"{months} month{(months > 1 ? "s" : "")} and {remainingDays} day{(remainingDays > 1 ? "s" : "")}";
            else
                return $"{months} month{(months > 1 ? "s" : "")}";
        }
        else if (timeSpan.TotalDays >= 1)
        {
            var days = (int)timeSpan.TotalDays;
            return $"{days} day{(days > 1 ? "s" : "")}";
        }
        else
        {
            return "Less than a day";
        }
    }
}