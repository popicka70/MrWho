@using MrWho.Shared.Constants
@{
    ViewData["Title"] = "Access Denied";
    var clientId = ViewData[ViewDataKeys.ClientId] as string;
    var clientName = ViewData[ViewDataKeys.ClientName] as string;
    var returnUrl = ViewData[ViewDataKeys.ReturnUrl] as string;
    var logoUri = ViewData[ViewDataKeys.LogoUri] as string; // themed logo like login
    var routeParams = new System.Collections.Generic.Dictionary<string, string?>(System.StringComparer.OrdinalIgnoreCase);
    if (!string.IsNullOrEmpty(returnUrl))
    {
        routeParams[QueryParameterNames.ReturnUrl] = returnUrl;
    }
    if (!string.IsNullOrEmpty(clientId))
    {
        routeParams[QueryParameterNames.ClientId] = clientId;
    }
    var query = Context?.Request?.Query;
    if (query != null)
    {
        foreach (var kvp in query)
        {
            var key = kvp.Key;
            if (string.IsNullOrEmpty(key)) { continue; }
            if (string.Equals(key, QueryParameterNames.ReturnUrl, System.StringComparison.OrdinalIgnoreCase) ||
                string.Equals(key, QueryParameterNames.ClientId, System.StringComparison.OrdinalIgnoreCase))
            {
                continue;
            }
            var value = kvp.Value.ToString();
            if (!string.IsNullOrEmpty(value))
            {
                routeParams[key] = value;
            }
        }
    }
}

<div class="row justify-content-center">
    <div class="col-md-8 col-lg-6">
        <!-- Logo (client/realm-specific when provided, fallback to default) -->
        <div class="text-center mb-4">
            @if (!string.IsNullOrWhiteSpace(logoUri))
            {
                <img src="@logoUri" alt="@(clientName ?? "Client") Logo" class="mrwho-logo" />
            }
            else
            {
                <img src="~/images/AuthMrWho.jpeg" alt="MrWho Identity Server" class="mrwho-logo" />
            }
        </div>
        
        <div class="card border-warning">
            <div class="card-header bg-warning text-dark">
                <h4 class="mb-0"><i class="bi bi-exclamation-triangle-fill"></i> Access Denied</h4>
                @if (!string.IsNullOrEmpty(clientName))
                {
                    <p class="mb-0 mt-1">Unable to access <strong>@clientName</strong></p>
                }
            </div>
            <div class="card-body">
                <div class="alert alert-warning" role="alert">
                    @if (!string.IsNullOrEmpty(clientName))
                    {
                        <strong>Sorry, you don't have permission to access @clientName.</strong>
                    }
                    else
                    {
                        <strong>Sorry, you don't have permission to access this application.</strong>
                    }
                </div>
                
                <p>This could happen for several reasons:</p>
                <ul>
                    <li><strong>Realm Restriction:</strong> Your user account may belong to a different realm than the one required for this application.</li>
                    <li><strong>Client Access:</strong> The application you're trying to access may not be configured for your user type.</li>
                    <li><strong>Account Status:</strong> Your account may be disabled or require additional setup.</li>
                    <li>Contact your administrator for access to this application</li>
                    <li>Try logging in with a different account</li>
                    <li>Ensure you're using the correct application URL</li>
                </ul>

                @if (!string.IsNullOrEmpty(returnUrl))
                {
                    <div class="mt-4">
                        <small class="text-muted">
                            <strong>Attempted URL:</strong> <span class="text-break">@returnUrl</span>
                        </small>
                    </div>
                }

                <div class="d-flex gap-2 mt-4">
                    <a asp-controller="Auth" asp-action="Login"
                       asp-all-route-data="@routeParams"
                       class="btn btn-primary">
                        <i class="bi bi-arrow-left"></i> Try Different Account
                    </a>
                    <a href="/" class="btn btn-outline-secondary">
                        <i class="bi bi-house"></i> Go to Home
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .card-header .bi {
        margin-right: 8px;
    }
    .text-break {
        word-break: break-all;
    }
</style></style>