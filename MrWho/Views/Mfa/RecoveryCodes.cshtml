@model string[]
@{
    ViewData["Title"] = "Recovery Codes";
    var returnUrl = ViewData["ReturnUrl"] as string;
    var effectiveReturn = string.IsNullOrEmpty(returnUrl) ? "/" : returnUrl;
}

<div id="rc-root" class="row justify-content-center" data-return-url="@effectiveReturn">
    <div class="col-md-8 col-lg-6">
        <!-- MrWho Logo -->
        <div class="text-center mb-4">
            <img src="~/images/AuthMrWho.jpeg" alt="MrWho Identity Server" class="mrwho-logo" />
        </div>
        
        <div class="card">
            <div class="card-header bg-success text-white">
                <h4 class="text-center mb-1">
                    <i class="bi bi-check-circle me-2"></i>Two-Factor Authentication Enabled!
                </h4>
                <p class="text-center mb-0 opacity-75">Save your recovery codes now</p>
            </div>
            <div class="card-body">
                <div class="alert alert-warning">
                    <h5><i class="bi bi-exclamation-triangle me-2"></i>Important - Save These Codes!</h5>
                    <ul class="mb-0">
                        <li>Each code can only be used <strong>once</strong></li>
                        <li>Use them if you lose access to your authenticator app</li>
                        <li>Store them in a <strong>secure location</strong> (password manager recommended)</li>
                        <li>Don't share these codes with anyone</li>
                    </ul>
                </div>
                
                <div class="mb-4">
                    <h5>Your Recovery Codes:</h5>
                    <div class="card bg-light">
                        <div class="card-body">
                            <div class="recovery-codes font-monospace" id="recoveryCodes" data-codes='@Html.Raw(Json.Serialize(Model))'>
@for (int i = 0; i < Model.Length; i++)
{
    <div class="recovery-code-item d-flex justify-content-between align-items-center py-2 @(i % 2 == 0 ? "bg-white" : "") px-3 rounded">
        <span class="fw-bold">@(i + 1).</span>
        <code class="fs-5 text-primary">@Model[i]</code>
    </div>
}
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="d-grid gap-2 mb-3">
                    <button id="btnCopyAll" type="button" class="btn btn-outline-primary">
                        <i class="bi bi-clipboard me-2"></i><span class="btn-text">Copy All Codes</span>
                    </button>
                    <button id="btnPrint" type="button" class="btn btn-outline-secondary">
                        <i class="bi bi-printer me-2"></i>Print Codes
                    </button>
                </div>
                
                <!-- Confirmation Checkbox and direct navigation button -->
                <div class="form-check mb-3 p-3 bg-light rounded">
                    <input class="form-check-input" type="checkbox" id="confirmSaved">
                    <label class="form-check-label fw-bold" for="confirmSaved">
                        <i class="bi bi-shield-check me-2 text-success"></i>
                        I have saved these recovery codes in a secure location
                    </label>
                </div>
                <div class="d-grid">
                    <button type="button" class="btn btn-success btn-lg" id="continueBtn">
                        <i class="bi bi-arrow-right me-2"></i>Continue to Dashboard
                    </button>
                </div>
                
                <div class="mt-3 text-center">
                    <small class="text-muted">
                        <i class="bi bi-info-circle me-1"></i>
                        You can generate new recovery codes later from your profile settings if needed.
                    </small>
                </div>
            </div>
        </div>
    </div>
</div>

@section Styles {
    <style>
        .recovery-code-item {
            border-left: 4px solid #0d6efd;
            transition: background-color 0.2s ease;
        }
        
        .recovery-code-item:hover {
            background-color: #e3f2fd !important;
        }
    </style>
}

@section Scripts {
    <script src="~/js/recovery-codes.js" asp-append-version="true"></script>
}
