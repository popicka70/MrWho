@using Radzen
@inject DialogService DialogService
@inject NotificationService NotificationService
@inject IJSRuntime JSRuntime

<RadzenStack Gap="1rem" Style="min-width: 0;">
    <RadzenAlert AlertStyle="AlertStyle.Warning" ShowIcon="true">
        <RadzenText TextStyle="TextStyle.Body2">
            This is the only time the new client secret will be shown. Copy and store it securely now. It will never be displayed again.
        </RadzenText>
    </RadzenAlert>

    <RadzenFormField Text="New Client Secret" Variant="Variant.Outlined">
        <ChildContent>
            <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" Gap="0.5rem" Wrap="FlexWrap.Wrap">
                <RadzenTextBox Value="@Secret" ReadOnly="true" Style="width: 100%; font-family: monospace; font-size: 0.95rem; max-width: 1000px;" />
                <RadzenButton Icon="content_copy" Text="Copy" ButtonStyle="ButtonStyle.Secondary" Click="@(async () => await Copy())" />
            </RadzenStack>
        </ChildContent>
        <Helper>
            <RadzenText TextStyle="TextStyle.Caption" class="rz-color-secondary">
                The secret will not be shown again. Keep it safe.
            </RadzenText>
        </Helper>
    </RadzenFormField>

    <RadzenStack Orientation="Orientation.Horizontal" JustifyContent="JustifyContent.End" Gap="0.5rem">
        <RadzenButton Text="Close" ButtonStyle="ButtonStyle.Primary" Click="@(() => DialogService.Close(true))" />
    </RadzenStack>
</RadzenStack>

@code {
    [Parameter] public string Secret { get; set; } = string.Empty;

    private async Task Copy()
    {
        try
        {
            await JSRuntime.InvokeVoidAsync("navigator.clipboard.writeText", Secret);
            NotificationService.Notify(NotificationSeverity.Success, "Copied", "Secret copied to clipboard");
        }
        catch
        {
            NotificationService.Notify(NotificationSeverity.Warning, "Copy failed", "Could not copy to clipboard");
        }
    }
}
