@using MrWho.Shared.Models

@if (editUser.isLoading)
{
    <RadzenCard class="rz-my-4">
        <RadzenProgressBarCircular ShowValue="false" Mode="ProgressBarMode.Indeterminate" />
        <RadzenText class="rz-mt-3">Loading user data...</RadzenText>
    </RadzenCard>
}
else
{
<div style="padding: 1 rem;">
    <RadzenStack Gap="2rem">
        <RadzenStack Gap="0.75rem" class="rz-mb-2">
            <RadzenText TextStyle="TextStyle.Subtitle1" class="rz-font-weight-600">User Information</RadzenText>
            <RadzenStack Gap="1rem">
                <RadzenRow>
                    <RadzenColumn Size="12" SizeMD="6">
                        <RadzenFormField Text="Email Address" Variant="Variant.Outlined">
                            <RadzenTextBox @bind-Value="editUser.userModel.Email" Placeholder="user@example.com" Style="width: 100%;" Disabled="@editUser.IsEdit" />
                            <RadzenText TextStyle="TextStyle.Caption" class="rz-color-secondary">
                                @(editUser.IsEdit ? "Email cannot be changed after creation" : "This will be used for login")
                            </RadzenText>
                        </RadzenFormField>
                    </RadzenColumn>
                    <RadzenColumn Size="12" SizeMD="6">
                        <RadzenFormField Text="Username" Variant="Variant.Outlined">
                            <RadzenTextBox @bind-Value="editUser.userModel.UserName" Placeholder="Enter username" Style="width: 100%;" Disabled="@editUser.IsEdit" />
                            <RadzenText TextStyle="TextStyle.Caption" class="rz-color-secondary">
                                @(editUser.IsEdit ? "Username cannot be changed after creation" : "Leave blank to use email as username")
                            </RadzenText>
                        </RadzenFormField>
                    </RadzenColumn>
                </RadzenRow>

                @if (!editUser.IsEdit)
                {
                    <RadzenRow>
                        <RadzenColumn Size="12" SizeMD="6">
                            <RadzenFormField Text="Password" Variant="Variant.Outlined">
                                <RadzenStack Orientation="Orientation.Horizontal" Gap="0.5rem" AlignItems="AlignItems.Stretch">
                                    <RadzenTextBox @bind-Value="editUser.userModel.Password" Type="@(editUser.showPassword ? "text" : "password")" Placeholder="Enter password" Style="flex: 1;" />
                                    <RadzenButton Icon="@(editUser.showPassword ? "visibility_off" : "visibility")" ButtonStyle="ButtonStyle.Light" Click="@(() => editUser.showPassword = !editUser.showPassword)" />
                                    <RadzenButton Icon="refresh" ButtonStyle="ButtonStyle.Secondary" Text="Generate" Click="@(() => editUser.GeneratePassword())" />
                                </RadzenStack>
                                <RadzenText TextStyle="TextStyle.Caption" class="rz-color-secondary">Minimum 8 characters with mixed case, numbers, and symbols</RadzenText>
                            </RadzenFormField>
                        </RadzenColumn>
                        <RadzenColumn Size="12" SizeMD="6">
                            <RadzenFormField Text="Confirm Password" Variant="Variant.Outlined">
                                <RadzenTextBox @bind-Value="editUser.confirmPassword" Type="password" Placeholder="Confirm password" Style="width: 100%;" />
                            </RadzenFormField>
                        </RadzenColumn>
                    </RadzenRow>
                }
                else
                {
                    <RadzenRow>
                        <RadzenColumn Size="12" SizeMD="6">
                            <RadzenFormField Text="User ID" Variant="Variant.Outlined">
                                <RadzenTextBox Value="@(editUser.currentUser?.Id ?? string.Empty)" ReadOnly="true" Style="width: 100%;" />
                            </RadzenFormField>
                        </RadzenColumn>
                        <RadzenColumn Size="12" SizeMD="6">
                            <RadzenFormField Text="Phone Number" Variant="Variant.Outlined">
                                <RadzenTextBox @bind-Value="editUser.userModel.PhoneNumber" Placeholder="+1 (555) 123-4567" Style="width: 100%;" />
                                <RadzenText TextStyle="TextStyle.Caption" class="rz-color-secondary">Optional - used for two-factor authentication</RadzenText>
                            </RadzenFormField>
                        </RadzenColumn>
                    </RadzenRow>
                }

                @if (!editUser.IsEdit)
                {
                    <RadzenFormField Text="Phone Number" Variant="Variant.Outlined">
                        <RadzenTextBox @bind-Value="editUser.userModel.PhoneNumber" Placeholder="+1 (555) 123-4567" Style="width: 100%;" />
                        <RadzenText TextStyle="TextStyle.Caption" class="rz-color-secondary">Optional - used for two-factor authentication</RadzenText>
                    </RadzenFormField>
                }

                <RadzenStack Gap="0.75rem" class="rz-mt-2">
                    <RadzenText TextStyle="TextStyle.Subtitle1" class="rz-font-weight-600">Status</RadzenText>
                    <RadzenRow Gap="1rem">
                        <RadzenColumn Size="12" SizeMD="4">
                            <RadzenFormField Text="Email Confirmation" Variant="Variant.Outlined">
                                <Start>
                                    <RadzenCheckBox @bind-Value="editUser.userModel.EmailConfirmed" Name="emailConfirmed" />
                                </Start>
                                <ChildContent>
                                    <RadzenLabel Text="Email address is confirmed" Component="emailConfirmed" />
                                </ChildContent>
                            </RadzenFormField>
                        </RadzenColumn>
                        <RadzenColumn Size="12" SizeMD="4">
                            <RadzenFormField Text="Phone Confirmation" Variant="Variant.Outlined">
                                <Start>
                                    <RadzenCheckBox @bind-Value="editUser.userModel.PhoneNumberConfirmed" Name="phoneConfirmed" />
                                </Start>
                                <ChildContent>
                                    <RadzenLabel Text="Phone number is confirmed" Component="phoneConfirmed" />
                                </ChildContent>
                            </RadzenFormField>
                        </RadzenColumn>
                        <RadzenColumn Size="12" SizeMD="4">
                            <RadzenFormField Text="Two-Factor Authentication" Variant="Variant.Outlined">
                                <Start>
                                    <RadzenCheckBox @bind-Value="editUser.userModel.TwoFactorEnabled" Name="twoFactor" />
                                </Start>
                                <ChildContent>
                                    <RadzenLabel Text="Two-factor authentication is enabled" Component="twoFactor" />
                                </ChildContent>
                            </RadzenFormField>
                        </RadzenColumn>
                    </RadzenRow>
                </RadzenStack>
            </RadzenStack>
        </RadzenStack>
    </RadzenStack>
</div>
}

@code {
    [Parameter] public EditUser editUser { get; set; } = null!;
}
