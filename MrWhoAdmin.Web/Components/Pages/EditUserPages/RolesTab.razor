@using MrWho.Shared.Models

@if (!editUser.IsEdit)
{
    <RadzenAlert AlertStyle="AlertStyle.Info"><RadzenText>Save user first to manage roles.</RadzenText></RadzenAlert>
}
else
{
    <div style="padding: 1rem;">
        <RadzenStack Gap="2rem">
            <RadzenStack Orientation="Orientation.Horizontal" JustifyContent="JustifyContent.SpaceBetween" AlignItems="AlignItems.Center">
                <RadzenText TextStyle="TextStyle.H6" Text="User Roles" />
                <RadzenBadge BadgeStyle="BadgeStyle.Success" Text="@($"{editUser.userRoles.Count} roles")" />
            </RadzenStack>
            <RadzenCard Style="background-color: var(--rz-base-50);">
                <RadzenStack Gap="1rem">
                    <RadzenText TextStyle="TextStyle.Subtitle1" Text="Assign Role" />
                    <RadzenText TextStyle="TextStyle.Caption" class="rz-color-secondary">
                        Roles provide groups of permissions and appear in the 'role' claim when the roles scope is requested.
                    </RadzenText>
                    <RadzenRow>
                        <RadzenColumn Size="12" SizeMD="8">
                            <RadzenFormField Text="Available Roles" Variant="Variant.Outlined">
                                <RadzenDropDown @bind-Value="editUser.selectedRoleId" Data="@editUser.availableRoles" TextProperty="Name" ValueProperty="Id" Placeholder="Select a role to assign" Style="width: 100%;" />
                            </RadzenFormField>
                        </RadzenColumn>
                        <RadzenColumn Size="12" SizeMD="4">
                            <RadzenFormField Text="Action" Variant="Variant.Outlined">
                                <RadzenButton Click="@(async () => await editUser.AssignRole())" Icon="add" ButtonStyle="ButtonStyle.Success" Text="Assign Role" Disabled="@(string.IsNullOrWhiteSpace(editUser.selectedRoleId))" IsBusy="@editUser.isAssigningRole" Style="width: 100%;" />
                            </RadzenFormField>
                        </RadzenColumn>
                    </RadzenRow>
                </RadzenStack>
            </RadzenCard>
            <RadzenStack Gap="0.75rem">
                <RadzenText TextStyle="TextStyle.Subtitle1" class="rz-font-weight-600">Assigned Roles</RadzenText>
                @if (editUser.userRoles.Any())
                {
                    <RadzenStack Orientation="Orientation.Horizontal" Gap="1rem" Wrap="FlexWrap.Wrap">
                        @foreach (var role in editUser.userRoles)
                        {
                            <RadzenBadge BadgeStyle="BadgeStyle.Success" class="rz-p-3">
                                <RadzenStack Orientation="Orientation.Horizontal" Gap="0.5rem" AlignItems="AlignItems.Center">
                                    <RadzenIcon Icon="group" />
                                    <RadzenText Text="@role.Name" />
                                    <RadzenButton Click="@(async () => await editUser.RemoveRole(role.Id))" Icon="close" Size="ButtonSize.ExtraSmall" ButtonStyle="ButtonStyle.Danger" Variant="Variant.Text" />
                                </RadzenStack>
                            </RadzenBadge>
                        }
                    </RadzenStack>
                }
                else
                {
                    <RadzenAlert AlertStyle="AlertStyle.Info">
                        <RadzenText>No roles assigned to this user. Assign roles above to grant permissions.</RadzenText>
                    </RadzenAlert>
                }
            </RadzenStack>
        </RadzenStack>
    </div>
}

@code {
    [Parameter] public EditUser editUser { get; set; } = null!;
}
