@page
@model MrWhoDemo1.Pages.Account.LoginModel
@{
    ViewData["Title"] = "Login with MrWho";
}

<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card border-0 shadow">
                <div class="card-header bg-primary text-white text-center py-4">
                    <h2 class="mb-0"><i class="bi bi-shield-check"></i> Login to MrWho Demo 1</h2>
                    <p class="mb-0 mt-2 opacity-75">Secure authentication via MrWho Identity Server</p>
                </div>
                <div class="card-body p-5">
                    
                    <!-- OpenID Connect Flow Explanation -->
                    <div class="alert alert-info border-0 mb-4">
                        <div class="d-flex align-items-start">
                            <i class="bi bi-info-circle-fill fs-4 text-info me-3 mt-1"></i>
                            <div>
                                <h5 class="alert-heading mb-2">How Authentication Works</h5>
                                <p class="mb-2">This demo application uses <strong>OpenID Connect (OIDC)</strong> for secure authentication. Here's what happens when you login:</p>
                                <ol class="mb-0 ps-3">
                                    <li><strong>Redirect to Identity Server:</strong> You'll be redirected to the MrWho Identity Server</li>
                                    <li><strong>Secure Login:</strong> Enter your credentials on the trusted identity server</li>
                                    <li><strong>Return with Token:</strong> You'll be redirected back with authentication tokens</li>
                                    <li><strong>Access Granted:</strong> Explore the demo features with your authenticated session</li>
                                </ol>
                            </div>
                        </div>
                    </div>

                    <!-- Demo Credentials -->
                    <div class="card bg-light border-0 mb-4">
                        <div class="card-body">
                            <div class="row align-items-center">
                                <div class="col-md-6">
                                    <h6 class="text-primary mb-2"><i class="bi bi-person-badge"></i> Demo User Account</h6>
                                    <p class="mb-1"><strong>Username:</strong> <code class="bg-white px-2 py-1 rounded">demo1@example.com</code></p>
                                    <p class="mb-0"><strong>Password:</strong> <code class="bg-white px-2 py-1 rounded">Demo123</code></p>
                                </div>
                                <div class="col-md-6 text-md-end mt-3 mt-md-0">
                                    <small class="text-muted">
                                        <i class="bi bi-shield-lock"></i> 
                                        These credentials will be entered on the secure<br>
                                        MrWho Identity Server login page
                                    </small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Login Actions -->
                    <div class="row g-3">
                        <div class="col-md-6">
                            <div class="card border-primary h-100">
                                <div class="card-body text-center p-4">
                                    <i class="bi bi-rocket fs-1 text-primary mb-3"></i>
                                    <h5 class="card-title">Quick Demo Login</h5>
                                    <p class="card-text text-muted">
                                        Jump straight to the MrWho Identity Server to login with the demo credentials.
                                    </p>
                                    <form method="post" asp-page-handler="Challenge">
                                        <input type="hidden" name="returnUrl" value="@Model.ReturnUrl" />
                                        <button type="submit" class="btn btn-primary btn-lg w-100">
                                            <i class="bi bi-box-arrow-in-right"></i> Login with MrWho
                                        </button>
                                    </form>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="card border-secondary h-100">
                                <div class="card-body text-center p-4">
                                    <i class="bi bi-info-circle fs-1 text-secondary mb-3"></i>
                                    <h5 class="card-title">Learn More</h5>
                                    <p class="card-text text-muted">
                                        Explore the technical details of this OIDC implementation.
                                    </p>
                                    <div class="d-grid gap-2">
                                        <a href="https://localhost:7113/.well-known/openid-configuration" 
                                           target="_blank" class="btn btn-outline-secondary">
                                            <i class="bi bi-gear"></i> View OIDC Configuration
                                        </a>
                                        <a href="/" class="btn btn-outline-secondary">
                                            <i class="bi bi-house"></i> Back to Home
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Technical Details -->
                    <div class="mt-4">
                        <details class="border rounded p-3">
                            <summary class="fw-bold text-primary" style="cursor: pointer;">
                                <i class="bi bi-code-square"></i> Technical Implementation Details
                            </summary>
                            <div class="mt-3">
                                <div class="row">
                                    <div class="col-md-6">
                                        <h6>OIDC Configuration</h6>
                                        <ul class="list-unstyled small">
                                            <li><strong>Client ID:</strong> <code>mrwho_demo1</code></li>
                                            <li><strong>Authority:</strong> <code>https://localhost:7113</code></li>
                                            <li><strong>Flow:</strong> Authorization Code with PKCE</li>
                                            <li><strong>Scopes:</strong> openid, profile, email, roles</li>
                                        </ul>
                                    </div>
                                    <div class="col-md-6">
                                        <h6>Security Features</h6>
                                        <ul class="list-unstyled small">
                                            <li><i class="bi bi-check-circle text-success"></i> PKCE (Proof Key for Code Exchange)</li>
                                            <li><i class="bi bi-check-circle text-success"></i> State parameter validation</li>
                                            <li><i class="bi bi-check-circle text-success"></i> HTTPS-only communication</li>
                                            <li><i class="bi bi-check-circle text-success"></i> Secure cookie sessions</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </details>
                    </div>

                    <!-- Footer -->
                    <div class="text-center mt-4 pt-3 border-top">
                        <small class="text-muted">
                            <i class="bi bi-shield-check"></i>
                            Powered by <strong>MrWho Identity Server</strong> • 
                            OpenID Connect • ASP.NET Core Identity
                        </small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // Provide user feedback when login starts
        document.addEventListener('DOMContentLoaded', function() {
            const loginForms = document.querySelectorAll('form[asp-page-handler="Challenge"]');
            loginForms.forEach(form => {
                form.addEventListener('submit', function(e) {
                    const button = form.querySelector('button[type="submit"]');
                    button.innerHTML = '<i class="bi bi-arrow-repeat"></i> Redirecting to MrWho...';
                    button.disabled = true;
                    
                    // Add spinning animation
                    const icon = button.querySelector('i');
                    if (icon) {
                        icon.style.animation = 'spin 1s linear infinite';
                    }
                });
            });
        });
    </script>
}